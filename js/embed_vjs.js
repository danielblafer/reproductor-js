var player;$(document).ready(function(){var resizer;$("#start").click(function(){$("#message").text('Solicitando video...');request(0);});function request(num){$.get(check_url,function(data){if(typeof data.sleep!="undefined"&&num<2){num=num+1;if(isNaN(data.sleep))
data.sleep=3000;setTimeout(function(){request(num);},data.sleep);}else if(typeof data.file!=='undefined'){var sources;if(data.file){sources=[{type:"video/mp4",src:data.file}];}else{sources=data.sources;}
player=videojs('my-player',{techOrder:["html5","flash"],autoplay:true,sources:sources,width:$(window).width(),height:$(window).height(),});startScreenshot();window.onresize=function(){clearTimeout(resizer);resizer=setTimeout(resizeVideoJS,100);};$('#player').show();$('#message').remove();}else{$("#message").text('Ha ocurrido un error: '+data.error);}},"json").fail(function(){$("#message").text('Ha ocurrido un error, el servidor no respondio correctamente');});}
function resizeVideoJS(){$("#my-player").width($(window).width()).height($(window).height());}});/*!videojs-snapshot a medida*/var screenshot=document.getElementById('screenshot');screenshot.innerHTML='<h3>Captura de pantalla</h3><h4>Para guardar presiona clic derecho > guardar imagen.</h4><canvas id="cnv"></canvas><a id="close-lightbox" class="long-animate" href="#"></a>';var video=document.querySelector('video');var canvas=document.querySelector('canvas');var context=canvas.getContext('2d');var w,h,ratio;video.addEventListener('loadedmetadata',function(){document.querySelector('video').crossOrigin="Anonymous";ratio=video.videoWidth/video.videoHeight;w=video.videoWidth-100;h=parseInt(w/ratio,10);canvas.width=w;canvas.height=h;},false);var imgdata;function snap(){player.pause();context.fillRect(0,0,w,h);context.drawImage(video,0,0,w,h);player.pause();}
function addNewButton(data){var myPlayer=data.player,controlBar,newElement=document.createElement('div'),newLink=document.createElement('a');newElement.id=data.id;newElement.className='downloadStyle vjs-control';newLink.innerHTML=data.html;newElement.appendChild(newLink);controlBar=document.getElementsByClassName('vjs-control-bar')[0];insertBeforeNode=document.getElementsByClassName('vjs-fullscreen-control')[0];controlBar.insertBefore(newElement,insertBeforeNode);return newElement;}
function closeFullscreen(){if(document.exitFullscreen){document.exitFullscreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.webkitExitFullscreen){document.webkitExitFullscreen();}else if(document.msExitFullscreen){document.msExitFullscreen();}}
function startScreenshot(){var btna=addNewButton({player:player,html:'<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"> <title>camera</title> <path fill="#fff" d="M0 6c0-1.1 0.9-2 2-2h3l2-2h6l2 2h3c1.105 0 2 0.895 2 2v0 10c0 1.105-0.895 2-2 2v0h-16c-1.105 0-2-0.895-2-2v0-10zM10 16c2.761 0 5-2.239 5-5s-2.239-5-5-5v0c-2.761 0-5 2.239-5 5s2.239 5 5 5v0zM10 14c-1.657 0-3-1.343-3-3s1.343-3 3-3v0c1.657 0 3 1.343 3 3s-1.343 3-3 3v0z"></path> </svg>',id:"downloadButton"});btna.onclick=function(){closeFullscreen();screenshot.className='abierto';snap();var canvas=document.getElementById('cnv'),context=canvas.getContext('2d');document.getElementById('close-lightbox').onclick=function(){screenshot.className='cerrado';player.play();return false;}};}